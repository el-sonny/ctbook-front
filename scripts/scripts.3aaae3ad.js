"use strict";function contractsCtrl(a,b,c,d){function e(a,c){a&&(b("filters").close(),u.params[c].push(a),u.params.page=1,u.refresh())}function f(){u.params.dependencias=[],u.params.empresas=[],u.params.ucs=[],u.refresh()}function g(){u.loading=!0,c.setParams(u.params),d.getContracts(u.params).then(u.setContracts)}function h(){d.getContractMeta(u.params).then(p)}function i(a){for(var b=new Array(a),c=0;a>c;c++)b[c]=c+1;return b}function j(){u.params=c.getParams(),u.refresh(),u.endPagination=8}function k(a){u.params.page=a,u.getContracts()}function l(){u.params.page+=1,u.params.page=u.params.page<=u.pages?u.params.page:1,u.getContracts()}function m(){u.params.page-=1,u.params.page=u.params.page>0?u.params.page:1,u.getContracts()}function n(){u.getContracts(),u.getContractMeta()}function o(a,b){for(var c in u.params[a])if(u.params[a][c].id===b.id){u.params[a].splice(c,1);break}u.refresh()}function p(a){u.pages=a.pages,u.sum=a.sum}function q(a){u.loading=!1,u.contracts=a,u.params=d.completeParams(u.params,u.contracts),u.params.page>7?u.endPagination=u.params.page:u.endPagination=8}function r(){for(var a in u.params)if(0!==u.params[a].length&&("dependencias"===a||"empresas"===a||"ucs"===a))return!0;return!1}function s(){u.params.page=1,u.refresh()}function t(a){13===a.which&&u.refresh()}var u=this;u.addItem=e,u.clearFilters=f,u.getContractMeta=h,u.getContracts=g,u.getRange=i,u.init=j,u.moveToPage=k,u.nextPage=l,u.prevPage=m,u.refresh=n,u.removeItem=o,u.searchObjectsExists=r,u.setContractMeta=p,u.setContracts=q,u.sliderup=s,u.textSearch=t,u.init(),a.$on("params change",u.init)}function contratoCtrl(a,b,c,d){function e(){b.getTweets("#"+i.contract.hashTag).then(i.setTweets)}function f(){c.getContract(i.contractId).then(i.setContract),i.params=d.getParams()}function g(a){i.contract=a,i.contract.hashTag=i.contract.numero_procedimiento.replace(/-/g,""),i.loading=!1}function h(a){i.tweets=a}var i=this;i.contractId=a.contractId,i.getTweets=e,i.init=f,i.loading=!0,i.setContract=g,i.setTweets=h,i.init()}function companiesCtrl(a){function b(b){var c={sort:"totalContractAmmount DESC",limit:100};g.loading=!0,angular.extend(c,b),a.getCompanies(c).then(e)}function c(){g.load(),g.page+=1}function d(a,b){a(b)}function e(a){g.loading=!1,g.companies=a}function f(a){g.load({sort:"proveedor_contratista ASC",where:{proveedor_contratista:{contains:a}}}),console.log(a)}var g=this;g.companies=[],g.letter="a",g.load=b,g.nextPage=c,g.openMenu=d,g.page=0,g.setCompanies=e,g.textQuery=f,g.load()}function companyCtrl(a,b,c){function d(){c.mode=h.histMode,h.loading=!0,h.loadingStats=!0,b.getCompany(h.companyId).then(h.setCompany),b.getContractStats({empresas:[{id:h.companyId}]}).then(f)}function e(a){h.loading=!1,h.company=a}function f(a){h.loadingStats=!1,h.stats=a,h.chartOptions.histogram=c.histogram(h.stats.frequency[0].values)}function g(){c.mode=h.histMode,h.api.update()}var h=this;h.companyId=a.companyId,h.changeHistMode=g,h.chartOptions={},h.chartOptions.histogram=c.histogram(h.frequencies),h.chartOptions.pie=c.pie(),h.chartOptions.stacked=c.stackedArea(),h.histMode="frecuencias",h.load=d,h.setCompany=e,h.setStats=f,h.load()}function chartService(){function a(a,b){var c,e,f,g;if(a){var h=a.map(function(a){return a.sum});c=Math.max.apply(Math,h),e=Math.min.apply(Math,h);var i=a.map(function(a){return a.frequency});f=Math.max.apply(Math,i),g=Math.min.apply(Math,i)}else e=0,c=1,g=0,f=1;return{chart:{type:"discreteBarChart",refreshDataOnly:!0,deepWatchData:!1,deepWatchOptions:!1,autorefresh:!1,height:450,margin:{top:20,right:20,bottom:120,left:35},x:function(a){return a.range},y:function(a){return"frecuencias"===d.mode?a.frequency:Math.round(a.sum/1e5)/10},color:function(a){if("frecuencias"===d.mode){var b=d3.scale.linear().domain([e,(c-e)/2+e,c]).range(["#ccccff","#cc22ff","red"]),h=b(a.sum);return h}var i=d3.scale.linear().domain([g,(f-g)/2+g,f]).range(["#ccccff","#cc22ff","red"]);return i(a.frequency)},transitionDuration:500,xAxis:{axisLabel:"Rango",rotateLabels:-45,axisLabelDistance:10},yAxis:{axisLabel:"frecuencias"===d.mode?"Numero de contratos":"Millones de pesos",axisLabelDistance:0,tickFormat:function(a){return a}}}}}function b(){return{chart:{type:"pieChart",height:200,donut:!0,showLabels:!1,pie:{},x:function(a){return a.agency},y:function(a){return a.ammount},duration:500,legendPosition:"right",showLegend:!1}}}function c(){return{chart:{type:"stackedAreaChart",useInteractiveGuideline:!0,useVoronoi:!1,height:450,margin:{top:20,right:50,bottom:60,left:60},x:function(a){return a.year},y:function(a){return Math.round(a.ammount/1e4)/100},showValues:!0,valueFormat:function(a){return a},transitionDuration:500,xAxis:{axisLabel:"AÃ±o"},yAxis:{showMaxMin:!1,axisLabel:"Millones de pesos",axisLabelDistance:0}}}}var d={histogram:a,pie:b,stackedArea:c};return d}function dependenciaCtrl(a,b){function c(){e.loading=!0,b.getDependencia(e.depId).then(e.setDep);var a={dependencias:[{id:e.depId}],definitivos:!0};b.getContracts(a),b.getDependenciaBlackList(e.depId).then(function(a){e.blaclistedCompanies=a})}function d(a){e.loading=!1,e.dep=a}var e=this;e.depId=a.depId,e.init=c,e.setDep=d,e.init()}angular.module("ctbookApp",["ngRoute","ngMaterial","ngTwitter","contentful","restangular","nvd3"]),angular.module("ctbookApp").config(["$routeProvider","$locationProvider",function(a,b){b.hashPrefix(""),a.when("/contratos",{templateUrl:"views/contracts.html",controller:"ContractsCtrl",controllerAs:"vm",reloadOnSearch:!1}).when("/contrato/:contractId",{templateUrl:"views/contrato.html",controller:"ContratoCtrl",controllerAs:"vm"}).when("/dependencias",{templateUrl:"views/dependencias.html",controller:"DependenciasCtrl",controllerAs:"vm"}).when("/dependencia/:depId",{templateUrl:"views/dependencia.html",controller:"DependenciaCtrl",controllerAs:"vm"}).when("/widget",{templateUrl:"templates/pages/widget.html",controller:"contratoCtrl"}).when("/companies",{templateUrl:"views/companies.html",controller:"CompaniesCtrl",controllerAs:"vm"}).when("/empresas",{templateUrl:"views/companies.html",controller:"CompaniesCtrl",controllerAs:"vm"}).when("/company/:companyId",{templateUrl:"views/company.html",controller:"CompanyCtrl",controllerAs:"vm"}).when("/empresa/:companyId",{templateUrl:"views/company.html",controller:"CompanyCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/contratos"})}]),angular.module("ctbookApp").config(["contentfulProvider",function(a){a.setOptions({space:"wih8dujs4vq4",accessToken:"4f71400e47c59d849a2c5a435cd9eb38346e0e0c888f2c28385342876c6f00d9"})}]).config(["RestangularProvider",function(a){a.setBaseUrl("http://ctbook-api.herokuapp.com/")}]).config(["$mdThemingProvider",function(a){var b=a.extendPalette("indigo",{A100:"rgba(255,255,255,.75);"}),c=a.extendPalette("blue",{500:"1C7EE1"});a.definePalette("ctBookBackground",b),a.definePalette("ctBookPimary",c),a.theme("default").primaryPalette("ctBookPimary").accentPalette("blue").backgroundPalette("ctBookBackground")}]),angular.module("ctbookApp").controller("MainCtrl",["$scope","$mdSidenav","$rootScope","ctbookApi","ctbookRoutes",function(a,b,c,d,e){function f(){console.log("toggleSidebar"),b("filters").toggle()}a.ctbookApi=d,a.ctbookRoutes=e,a.toggleFilters=!0,a.toggleSidebar=f,c.toggleSidebar=f,a.numberFormat=function(a){return(void 0===a||isNaN(a))&&(a="0"),a=Number(a),a.toLocaleString()},a.mdpify=function(a){return(void 0===a||isNaN(a))&&(a="0"),a=Number(a),Math.round(a/1e5)/10},a.contratosActionMenu=function(){"contratos"!==a.ctbookRoutes.basePath()?a.ctbookRoutes.path="/contratos":a.toggleFilters=!a.toggleFilters}}]),angular.module("ctbookApp").controller("HomeCtrl",["$scope","$location","$rootScope",function(a,b,c){a.path=b.path(),c.$on("packeryInstantiated",function(b,c){a.packery=c}),a.sizePack=function(a){var b={};return(a.fields.width||a.fields.height)&&(b.width=(a.fields.width||a.fields.height)+"px",b.height=(a.fields.height||a.fields.width)+"px"),a.fields.color&&(b["background-color"]=a.fields.color),b.sup="hey",b},a.getImageUrl=function(a){var b=a.fields.featuredImage;if(b){var c=a.fields.width||a.fields.height,d=a.fields.height||a.fields.width,e=c/d,f=b.fields.file.details.image.width/b.fields.file.details.image.height,g=e>=f?"?w="+c:"?h="+d;return b.fields.file.url+g}}}]),angular.module("ctbookApp").controller("ContractsCtrl",contractsCtrl),contractsCtrl.$inject=["$rootScope","$mdSidenav","ctbookRoutes","ctbookApi"],angular.module("ctbookApp").service("ctbookApi",["Restangular","$q",function(a,b){this.Contrato=a.all("contrato"),this.Dependencia=a.all("dependencia"),this.UnidadCompradora=a.all("unidadCompradora"),this.Empresa=a.all("empresa"),this.perPage=10,this.autocomplete=function(a,b,c){var d={where:{},limit:40};return d.where[b]={contains:a},this[c].getList(d)},this.completeParams=function(a,b){return a=this.completeParamsFromCache(a,b),a.empresas=this.completeParamsFromApi(a.empresas,"proveedor_contratista",this.Empresa),a.dependencias=this.completeParamsFromApi(a.dependencias,"dependencia",this.Dependencia),a.ucs=this.completeParamsFromApi(a.ucs,"nombre_de_la_uc",this.UnidadCompradora),a},this.completeParamsFromApi=function(a,b,c){for(var d=[],e=0;e<a.length;e++){var f=a[e];a[e][b]||(f.index=e,d.push(f))}if(d.length){var g=d.map(function(a){return a.id});g={where:{id:g}},c.getList(g).then(function(b){d.forEach(function(c){a[c.index]=b.filter(function(a){return a.id===c.id})[0]})})}return a},this.completeParamsFromCache=function(a,b){for(var c=0;c<a.empresas.length;c++)a.empresas[c]=this.findEntity(a.empresas[c],b,"provedorContratista");for(c=0;c<a.dependencias.length;c++)a.dependencias[c]=this.findEntity(a.dependencias[c],b,"dependencia2");for(c=0;c<a.ucs.length;c++)a.ucs[c]=this.findEntity(a.ucs[c],b,"unidadCompradora");return a},this.findEntity=function(a,b,c){for(var d=0;d<b.length;d++){var e=b[d];if(e&&e[c]&&e[c].id===a.id)return e[c]}return a},this.getContracts=function(a){return this.Contrato.getList(this.makeQuery(a))},this.getContract=function(b){return a.one("contrato",b).get()},this.getContractMeta=function(c){var d=this.makeQuery(c),e={},f=b.defer(),g=this.perPage;return this.Contrato.one("count").get(d).then(function(b){e.pages=Math.ceil(b.count/g),e.count=b.count,a.all("contrato").one("sum").get(d).then(function(a){e.sum=a.sum,f.resolve(e)})}),f.promise},this.getContractStats=function(a){var b=this.makeQuery(a);return this.Contrato.one("stats").get(b)},this.makeQuery=function(a){var b={year:{start:2002,end:2016},page:1};angular.extend(b,a);var d={fecha_inicio_year:{">=":b.year.start,"<=":b.year.end}};b.textFilter&&(d.titulo_contrato={contains:b.textFilter}),b.definitivos&&(d.Definitivo={"!":null});var e=this.perPage*(b.page-1),f={limit:this.perPage,skip:e,sort:"importe_contrato DESC",where:d};return angular.extend(f.where,c(b.dependencias,"dependencia2")),angular.extend(f.where,c(b.empresas,"provedorContratista")),angular.extend(f.where,c(b.ucs,"unidadCompradora")),f},this.getDependencias=function(a){a||(a={});var b={page:0,limit:20,letter:"a",sort:"dependencia ASC"};return angular.extend(b,a),a={limit:b.limit,skip:b.page*b.limit,sort:b.sort,where:{dependencia:{startsWith:b.letter}}},this.Dependencia.getList(a)},this.getDependencia=function(b){return a.one("dependencia",b).get()},this.getDependenciaBlackList=function(a){return this.Dependencia.one("definitivos",a).get()},this.getCompany=function(b){return a.one("empresa",b).get()},this.getCompanies=function(a){a||(a={});var b={limit:20,sort:"proveedor_contratista ASC"};return angular.extend(b,a),this.Empresa.getList(b)};var c=function(a,b){var c={};return a&&0!==a.length&&(c[b]=[],a.forEach(function(a){c[b].push(a.id)})),c}}]),angular.module("ctbookApp").service("ctbookRoutes",["$location","$rootScope",function(a,b){this.path=a.path(),this.basePath=function(){return this.path=a.path(),this.path.split("/")[1]},this.getParams=function(){var b=Object.keys(a.search())[0];return this.decodeParams(b)},this.setParams=function(b){var c=this.encodeParams(b);a.search(c)},b.$on("$locationChangeSuccess",function(){b.actualLocation=a.search()}),b.$watch(function(){return a.search()},function(a){b.actualLocation===a&&b.$emit("params change")}),this.encodeParams=function(a){if("object"==typeof a){var b=[];if("object"==typeof a.year&&(2002!==a.year.start||2016!==a.year.end)){var c="Y"+a.year.start+"-"+a.year.end;b.push(c)}return a.page&&1!==a.page&&b.push("P"+a.page),"object"==typeof a.empresas&&a.empresas.forEach(function(a){b.push("E"+a.id)}),"object"==typeof a.dependencias&&a.dependencias.forEach(function(a){b.push("D"+a.id)}),"object"==typeof a.ucs&&a.ucs.forEach(function(a){b.push("U"+a.id)}),b.join(".")}return""},this.decodeParams=function(a){a||(a="");var b={year:{start:2002,end:2016},empresas:[],dependencias:[],ucs:[],page:1},c=a.split(".");return c.forEach(function(a){var c=a.slice(0,1),d=a.slice(1);"Y"===c?(d=d.split("-"),b.year.start=parseInt(d[0]),b.year.end=parseInt(d[1])):"P"===c?b.page=parseInt(d):"D"===c?b.dependencias.push({id:d}):"E"===c?b.empresas.push({id:d}):"U"===c&&b.ucs.push({id:d})}),b}}]),angular.module("ctbookApp").controller("DependenciasCtrl",["$scope",function(a){a.params={letter:"a",page:0}}]),angular.module("ctbookApp").controller("ContratoCtrl",contratoCtrl),contratoCtrl.$inject=["$routeParams","twitter","ctbookApi","ctbookRoutes"],angular.module("ctbookApp").service("twitter",["Restangular",function(a){this.Twitter=a.all("twitter"),this.getTweets=function(a){return this.Twitter.getList({q:a})}}]),angular.module("ctbookApp").controller("CompaniesCtrl",companiesCtrl),companiesCtrl.$inject=["ctbookApi"],angular.module("ctbookApp").controller("CompanyCtrl",companyCtrl),companyCtrl.$inject=["$routeParams","ctbookApi","chartService"],angular.module("ctbookApp").service("chartService",chartService),angular.module("ctbookApp").controller("DependenciaCtrl",dependenciaCtrl),dependenciaCtrl.$inject=["$routeParams","ctbookApi"],angular.module("ctbookApp").run(["$templateCache",function(a){a.put("views/companies.html",'<div ng-include="\'views/sidebar.html\'" layout="row"></div> <div layout="column" flex layout-fill role="main" tab-index="-1" role="main"> <md-content class="main-container" flex layout-fill layout="column"> <div ng-show="vm.loading" layout-fill layout="column" layout-align="center center" flex> <md-progress-circular md-mode="indeterminate"></md-progress-circular> </div> <md-toolbar class="search-filter transparent-toolbar" layout="row" layout-md="column" layout-sm="column" layout-align="space-between start" ng-hide="vm.loading"> <!-- Los filtros seleccionados --> <section flex="80" flex-md="100" flex-sm="100"> <p><strong>Filtrar resultados de bÃºsqueda</strong></p> <md-content class="transparent-toolbar" style="min-height:86px"> <md-menu> <md-button aria-label="Open phone interactions menu" ng-click="vm.openMenu($mdOpenMenu, $event)"> Ordenar <i md-menu-origin class="fa fa-sort"></i> </md-button> <md-menu-content width="4"> <md-menu-item> <md-button ng-click="vm.load({sort: \'totalContractAmmount DESC\'})"> <md-icon class="fa fa-money plus"> Por monto total de contratos </md-icon></md-button> </md-menu-item> <md-menu-item> <md-button ng-click="vm.load({sort: \'totalContractCount DESC\'})"> <md-icon class="fa fa-sort-numeric-desc step"> Por numero de contratos </md-icon></md-button> </md-menu-item> <md-menu-item> <md-button ng-click="vm.load({sort: \'contractsMean DESC\'})"> <md-icon class="fa fa-usd step"> Por monto promedio </md-icon></md-button> </md-menu-item> </md-menu-content> </md-menu> </md-content> </section> </md-toolbar> <md-list layout="row" ng-hide="vm.loading" layout-wrap> <md-item ng-repeat="company in vm.companies" flex="50" layout-padding> <md-content class="contrato-item half"> <a ng-href="#/empresa/{{company.id}}" layout="column"> <p class="title">{{company.proveedor_contratista}}</p> <p class="title">$ {{numberFormat(mdpify(company.totalContractAmmount))}} MDP en {{company.totalContractCount}} contratos</p> <p class="title">Contrato Promedio : $ {{numberFormat(mdpify(company.contractsMean))}} MDP</p> </a> </md-content> </md-item> </md-list> </md-content> </div>'),a.put("views/company.html",'<div ng-include="\'views/sidebar.html\'" layout="row"></div> <!-- El Loader --> <div ng-show="vm.loading" layout-fill layout="column" layout-align="center center" flex> <md-progress-circular md-mode="indeterminate"></md-progress-circular> </div> <div class="wrap-main-container" layout="column" flex layout-fill role="main" tab-index="-1" role="main"> <md-content ng-show="!vm.loading" class="main-container" layout-fill flex layout="column"> <div class="contrato-item contrato-item-main md-whiteframe-z1"> <h2 class="ammount">{{vm.company.proveedor_contratista}}</h2> <div layout="row"> <ul class="data-items-list" flex ng-hide="loading"> <li> <p><strong>Numero de contratos:</strong> {{vm.company.totalContractCount}} </p> <p><strong>Monto total en contratos:</strong> $ {{mdpify(vm.company.totalContractAmmount)}} MDP</p> <p><strong>Contrato PromÃ©dio: </strong> $ {{mdpify(vm.company.contractsMean)}} MDP</p> <p><strong>Contrato mas grande:</strong> $ {{mdpify(vm.company.contractsMax)}} MDP</p> <p><strong>DesviaciÃ³n Estandar: </strong> $ {{mdpify(vm.company.contractsStdev)}} MDP</p> </li> </ul> <div> <nvd3 options="vm.chartOptions.pie" data="vm.stats.agencyDistribution"></nvd3> </div> </div> <div layout="column"> <h3 ng-hide="vm.loadingStats">Serie Historica</h3> <nvd3 options="vm.chartOptions.stacked" data="vm.stats.timeSeries"></nvd3> <div ng-hide="vm.loadingStats" layout="row"> <h3 flex ng-hide="vm.loadingStats">Histograma</h3> <div>Ver {{vm.histMode}}</div> <md-switch ng-true-value="\'montos\'" ng-false-value="\'frecuencias\'" ng-model="vm.histMode" aria-label="montos o frecuencias" class="md-block" ng-change="vm.changeHistMode()"> </md-switch> </div> <nvd3 options="vm.chartOptions.histogram" data="vm.stats.frequency" api="vm.api"></nvd3> </div> </div> </md-content> </div>'),a.put("views/contracts.html",'<div flex-sm="100" class="sidebar-wrapper" ng-include="\'views/sidebar.html\'" layout="row"></div> <md-content class="wrap-main-container" flex flex-sm="100" layout-fill role="main" tab-index="-1"> <div ng-include="\'views/header-mobile.html\'" hide-gt-md layout="row"> </div> <md-content class="main-container" flex layout-fill layout="column"> <md-toolbar class="search-header transparent-toolbar" layout="row" layout-wrap layout-align="space-between center" layout-align-md="space-between start" layout-align-sm="space-between start"> <div class="search-header-title" flex flex-md="100" flex-sm="100" flex-xs="100"> <h1><strong>BUSCA ANALIZA Y COMPARTE</strong></h1> <h1>LOS CONTRATOS DEL GOBIERNO</h1> </div> <div class="search-header-social" flex flex-md="100" flex-sm="100" flex-xs="100"> <!-- <a href="#"><i class="fa fa-facebook"></i></a> --> <a href="https://twitter.com/contratobook"><i class="fa fa-twitter"></i></a> </div> </md-toolbar> <md-toolbar class="search-filter transparent-toolbar" layout="row" layout-wrap layout-align="space-between start" ng-hide="vm.loading"> <!-- Los filtros seleccionados --> <section flex="80" flex-md="100" flex-sm="100" ng-hide="vm.params.dependencias.length === 0 && vm.params.ucs.length === 0 && vm.params.empresas.length === 0"> <p><strong>Filtrar resultados de bÃºsqueda</strong></p> <md-content class="transparent-toolbar" style="min-height:86px" ng-show="vm.searchObjectsExists()"> <md-checkbox md-no-ink ng-repeat="item in vm.params.dependencias track by $index" ng-init="dependencyChecked=true" ng-model="dependencyChecked" class="md-primary" ng-click="vm.removeItem(&quot;dependencias&quot;,item)"> {{item.dependencia}} </md-checkbox> <md-checkbox md-no-ink ng-repeat="item in vm.params.ucs track by $index" ng-init="ucChecked=true" ng-model="ucChecked" class="md-primary" ng-click="vm.removeItem(&quot;ucs&quot;,item)"> {{item.nombre_de_la_uc}} </md-checkbox> <md-checkbox md-no-ink ng-repeat="item in vm.params.empresas track by $index" ng-init="empresaChecked=true" ng-model="empresaChecked" class="md-primary" ng-click="vm.removeItem(&quot;empresas&quot;,item)"> {{item.proveedor_contratista}} </md-checkbox> </md-content> </section> <section flex-md="100" flex-sm="100" class="search-clear" ng-hide="vm.params.dependencias.length === 0 && vm.params.ucs.length === 0 && vm.params.empresas.length === 0"> <p><a href="" ng-click="vm.clearFilters()">Limpiar resultados <i class="fa fa-trash"></i></a></p> </section> </md-toolbar> <section class="search-results-info" layout="row" layout-align="space-between center"> <p class="search-results-text"><strong>Resultados de la bÃºsqueda</strong></p> <div ng-hide="!vm.pages || vm.pages <= 1">Pagina {{vm.params.page}} de {{vm.pages}}</div> </section> <!-- montos --> <md-toolbar class="sum-toolbar transparent-toolbar" layout="row" ng-hide="vm.loading"> <div> <div ng-hide="!vm.sum"> Monto de contratos : $ {{numberFormat(vm.sum)}} {{vm.sum_abbr}} <span ng-show="sum_abbr == &quot;&quot;">MXN</span> </div> </div> </md-toolbar> <!-- El Loader --> <div ng-show="vm.loading" layout-fill layout="column" layout-align="center center" flex> <md-progress-circular md-mode="indeterminate"></md-progress-circular> </div> <md-list ng-hide="vm.loading"> <!-- El listado --> <md-item ng-repeat="contract in vm.contracts"> <md-content layout="column" class="contrato-item"> <div layout="row" layout-wrap> <div flex="50" flex-md="100" flex-sm="100" flex-xs="100"> <h3 class="ammount"><a ng-href="#/contrato/{{contract.id}}">$ {{numberFormat(contract.importe_contrato)}} {{contract.moneda}}</a></h3> <p class="title"><a ng-href="#/contrato/{{contract.id}}">{{contract.titulo_contrato}}</a></p> <p class="light"><a ng-href="#/contrato/{{contract.id}}">{{contract.titulo_expediente}}</a></p> <p class="light"><a ng-href="#/contrato/{{contract.id}}">{{contract.tipo_procedimiento}} {{contract.caracter}}</a> </p> </div> <div flex="50" flex-md="100" flex-sm="100" flex-xs="100"> <ul class="data-items-list"> <li> <p> <!--<a ng-href="/contratos?D{{contract.dependencia2.id}}" ng-click="changeSearchParam(\'/contratos?D\'+ contract.dependencia2.id)">--> <a ng-href="#/contratos?D{{contract.dependencia2.id}}" target="_self"> <i class="fa fa-institution"></i> {{contract.dependencia}} </a> </p> </li> <li> <p> <!--<a ng-href="/contratos?U{{contract.unidadCompradora.id}}" ng-click="changeSearchParam(\'/contratos?U\'+ contract.unidadCompradora.id)">--> <a ng-href="#/contratos?U{{contract.unidadCompradora.id}}" target="_self"> <i class="fa fa-shopping-cart"></i> Unidad compradora </a> </p> <p> <!--<a class="data-item" ng-href="/contratos?U{{contract.unidadCompradora.id}}" ng-click="changeSearchParam(\'/contratos?U\'+ contract.unidadCompradora.id)">--> <a class="data-item" ng-href="#/contratos?U{{contract.unidadCompradora.id}}" target="_self"> {{contract.nombre_de_la_uc}} </a> </p> </li> <li> <p> <!--<a ng-href="/contratos?E{{contract.provedorContratista.id}}" ng-click="changeSearchParam(\'/contratos?E\'+ contract.provedorContratista.id)">--> <a ng-href="#/contratos?E{{contract.provedorContratista.id}}" target="_self"> <i class="fa fa-suitcase"></i> Empresa </a> </p> <p><a ng-href="#/empresa/{{contract.provedorContratista.id}}" class="data-item">{{contract.proveedor_contratista}}</a></p> </li> <li> <p> <a> <i class="fa fa-calendar"></i> Fecha de inicio del contrato </a> </p> <p><a href="#" class="data-item">{{contract.fecha_inicio}}</a></p> </li> </ul> </div> </div> <div ng-show="contract.show" class="md-tile-content"> <div ng-repeat="(key,value) in contract">{{key}} : {{value}}</div> </div> </md-content> </md-item> </md-list> <!-- pagination --> <md-toolbar class="transparent-toolbar pagination-wrapper" layout="row" layout-wrap layout-align="space-between center"> <div ng-include="\'views/footer.html\'"></div> <nav class="pagination-cb" ng-hide="!vm.pages || vm.pages <= 1" layout="row" ng-hide="vm.loading"> <a ng-click="vm.prevPage()" href="">&lt;</a> <a ng-repeat="itemPage in vm.getRange(vm.pages) | limitTo:8:(vm.endPagination-8) track by $index" ng-click="vm.moveToPage(itemPage)" ng-class="{\'current-page\': (itemPage) === vm.params.page}" href=""> {{itemPage}} </a> <a ng-click="vm.nextPage()" href="">&gt;</a> </nav> </md-toolbar> </md-content> </md-content>'),a.put("views/contrato.html",'<div ng-include="\'views/sidebar.html\'" layout="row"></div> <!-- El Loader --> <div ng-show="vm.loading" layout-fill layout="column" layout-align="center center" flex> <md-progress-circular md-mode="indeterminate"></md-progress-circular> </div> <div class="wrap-main-container" layout="column" flex layout-fill role="main" tab-index="-1" role="main"> <md-content ng-show="!vm.loading" class="main-container" layout-fill flex layout="column"> <div class="contrato-item contrato-item-main md-whiteframe-z1"> <section class="contrato-item-info"> <h2 class="ammount"><i class="fa fa-folder-open"></i></h2> <h2 class="ammount">$ {{numberFormat(vm.contract.importe_contrato)}} {{vm.contract.moneda}}</h2> <h1>{{vm.contract.titulo_contrato}}</h1> <h3>{{vm.contract.titulo_expediente}}</h3> <h3 class="procedimiento-text">{{vm.contract.tipo_procedimiento}} {{vm.contract.caracter}}</h3> <h3 class="procedimiento-text"><strong>#{{vm.contract.numero_procedimiento}}</strong></h3> </section> <ul class="data-items-list"> <li> <p> <a ng-href="#/contratos?D{{vm.contract.dependencia2.id}}"><i class="fa fa-institution"></i> <strong>InstituciÃ³n:</strong> {{vm.contract.dependencia}} </a> </p> </li> <li> <p> <a ng-href="#/contratos?U{{vm.contract.unidadCompradora.id}}"> <i class="fa fa-shopping-cart"></i> <strong>Unidad compradora:</strong> {{vm.contract.nombre_de_la_uc}} (clave: {{vm.contract.unidadCompradora.claveuc}}) </a> </p> </li> <li> <p> <a ng-href="#/empresa/{{vm.contract.provedorContratista.id}}"> <i class="fa fa-suitcase"></i> <strong>Proveedor contratista:</strong> {{vm.contract.proveedor_contratista}} </a> </p> </li> <li ng-if="vm.contract.fecha_inicio"> <p><i class="fa fa-calendar"></i> <strong>Fecha de inicio del contrato:</strong> {{vm.contract.fecha_inicio}}</p> </li> <li ng-if="vm.contract.fecha_fin"> <p><i class="fa fa-calendar"></i> <strong>Fecha fin del contrato:</strong> {{vm.contract.fecha_fin}}</p> </li> <li> <p><i class="fa fa-external-link"></i> <strong>InformaciÃ³n general del procedimiento: </strong> <a target="_blank" ng-href="{{vm.contract.anuncio}}">{{vm.contract.anuncio}}</a></p> </li> <li> <p><i class="fa fa-database"></i> <strong>Fuente:</strong> <a target="_blank" ng-href="{{vm.contract.source}}">{{vm.contract.source}}</a></p> </li> <li ng-if="vm.contract.responsable"> <p><i class="fa fa-user"></i> <strong>Responsable:</strong> {{vm.contract.responsable}}</p> </li> <li> <p><strong>CÃ³digo identificador del contrato:</strong> {{vm.contract.codigo_contrato}}</p> </li> <li> <p><strong>Tipo de contrataciÃ³n:</strong> {{vm.contract.tipo_contratacion}}</p> </li> <li> <p><strong>Tipo de procedimiento:</strong> {{vm.contract.tipo_procedimiento}}</p> </li> <li> <p><strong>Caracter:</strong> {{vm.contract.caracter}}</p> </li> <li ng-if="vm.contract.aportacion_federal"> <p><strong>Importe de AportaciÃ³n del Gobierno Federal(sin I.V.A):</strong> {{vm.contract.aportacion_federal}}</p> </li> <li ng-if="vm.contract.archivado"> <p><strong>Archivado:</strong> {{vm.contract.archivado}}</p> </li> <li ng-if="vm.contract.clave_cartera_shcp"> <p><strong>Clave de cartera:</strong> {{vm.contract.clave_cartera_shcp}}</p> </li> <li ng-if="vm.contract.clave_programa"> <p><strong>Clave del programa federal:</strong> {{vm.contract.clave_programa}}</p> </li> <li ng-if="vm.contract.compra_consolidada"> <p><strong>Compra consolidada:</strong> <span ng-if="vm.contract.compra_consolidada == 1">Si</span> <span ng-if="vm.contract.compra_consolidada == 0">No</span> </p> </li> <li ng-if="vm.contract.contrato_marco"> <p><strong>Contrato marco:</strong> <span ng-if="vm.contract.contrato_marco == 1">Si</span> <span ng-if="vm.contract.contrato_marco == 0">No</span> </p> </li> <li ng-if="vm.contract.cuenta_administrada_por"> <p><strong>Cuenta administrada por:</strong> <span ng-if="vm.contract.cuenta_administrada_por == \'PoC\'">Proveedor o Contratista</span> <span ng-if="vm.contract.cuenta_administrada_por != \'PoC\'">Unidad Compradora</span> </p> </li> <li ng-if="vm.contract.estatus_contrato"> <p><strong>Estatus del contrato:</strong> {{vm.contract.estatus_contrato}}</p> </li> <li ng-if="vm.contract.estatus_empresa"> <p><strong>Estatus de la empresa:</strong></p> <p ng-if="vm.contract.estatus_empresa == \'Habilitado\'"><strong>Habilitado</strong></p> <p ng-if="vm.contract.estatus_empresa == \'Habilitado\'"> Es el estado adquirido por la empresa cuando ha sido registrada en CompraNet, ya sea por su cuenta o por alguna Unidad Compradora, tratÃ¡ndose de procedimientos presenciales o mixtos. </p> <p ng-if="vm.contract.estatus_empresa == \'Reg\'"><strong>Reg</strong></p> <p ng-if="vm.contract.estatus_empresa == \'Reg\'"> Es el estado adquirido por la empresa cuando estÃ¡ en proceso de completar su registro. </p> <p ng-if="vm.contract.estatus_empresa == \'SCS\'"><strong>SCS</strong></p> <p ng-if="vm.contract.estatus_empresa == \'SCS\'"> Estado concedido por el sistema cuando existe alguna deficiencia en la informaciÃ³n incorporada para su registro en CompraNet. </p> </li> <li ng-if="vm.contract.estratificacion_muc"> <p><strong>EstratificaciÃ³n manifestada por la UC:</strong> {{vm.contract.estratificacion_muc}}</p> </li> <li ng-if="vm.contract.estratificacion_mpc"> <p><strong>EstratificaciÃ³n declarada por el proveedor o contratista a la fecha de emisiÃ³n del reporte</strong> {{vm.contract.estratificacion_mpc}}</p> </li> <li ng-if="vm.contract.exp_f_fallo"> <p><strong>Expediente fecha de fallo:</strong> {{vm.contract.exp_f_fallo}}</p> </li> <li ng-if="vm.contract.fecha_apertura_proposiciones"> <p><strong>Expediente fecha de apertura:</strong> {{vm.contract.fecha_apertura_proposiciones}}</p> </li> <li ng-if="vm.contract.fecha_celebracion"> <p><strong>Fecha de celebraciÃ³n:</strong> {{vm.contract.fecha_celebracion}}</p> </li> <li ng-if="vm.contract.forma_procedimiento"> <p><strong>Forma de procedimiento:</strong> {{vm.contract.forma_procedimiento}}</p> </li> <li ng-if="vm.contract.plantilla_expediente"> <p><strong>Plantilla expediente:</strong> {{vm.contract.plantilla_expediente}}</p> </li> <li ng-if="vm.contract.plurianual"> <p><strong>Plurianual:</strong> <span ng-if="vm.contract.plurianual == 1">Si</span> <span ng-if="vm.contract.plurianual == 0">No</span> </p> </li> <li ng-if="vm.contract.ramo"> <p><strong>Ramo:</strong> {{vm.contract.ramo}}</p> </li> <!--Solo disponibleen registros de compranet 2010-2012 --> <div ng-if="vm.contract.numero_expediente"> <li><p> <strong>Titulo Expediente:</strong> {{vm.contract.titulo_expediente}}</p></li> <li><p> <strong>Numero de Expediente:</strong> {{vm.contract.numero_expediente}}</p></li> </div> </ul> </div> </md-content> </div>'),a.put("views/dependencia.html",'<div ng-include="\'views/sidebar.html\'" layout="row"></div> <!-- El Loader --> <div ng-show="vm.loading" layout-fill layout="column" layout-align="center center" flex> <md-progress-circular md-mode="indeterminate"></md-progress-circular> </div> <div class="wrap-main-container" layout="column" flex layout-fill role="main" tab-index="-1" role="main"> <md-content ng-show="!vm.loading" class="main-container" layout-fill flex layout="column"> <div class="contrato-item contrato-item-main md-whiteframe-z1"> <h2 class="ammount">{{vm.dep.dependencia}}</h2> <h3>Empresas con las que tiene contratos y estan en lista Definitivos SAT:</h3> <ul> <li ng-repeat="comp in vm.blaclistedCompanies"> <a ng-href="#/contratos?E{{comp.id}}.D{{vm.dep.id}}">{{comp.proveedor_contratista}}</a> </li> </ul> </div></md-content> </div>'),a.put("views/dependencias.html",'<div ng-include="\'views/sidebar.html\'" layout="row"></div> <div layout="column" flex layout-fill role="main" tab-index="-1" role="main"> <md-content class="main-container" flex layout-fill layout="column"> <md-list layout="row" layout-wrap> <md-item ng-repeat="dependencia in dependencias" flex="50" layout-padding> <md-content class="rounded-box half"> <div layout="row"> <p>{{dependencia.dependencia}}</p> </div> </md-content> </md-item> </md-list> </md-content> </div>'),
a.put("views/footer.html",'<div class="footer" flex-md="100" flex-sm="100" flex-xs="100"> <p class="logos"> <a href="https://www.facebook.com/Ctransparente/?fref=ts" target="_blank"> <img src="images/ctransparente.d7e3b013.png" alt="Ciudadanos por la transparencia"> </a> <a href="http://spaceshiplabs.com/" target="_blank"> <img src="images/spaceshiplabs.a1613d52.png" alt="Spaceshiplabs"> </a> </p> </div>'),a.put("views/header-mobile.html",'<div class="header-mobile-content" layout="row"> <a ng-click="toggleSidebar()" href="" class="menu-btn"> <span></span> <span></span> <span></span> </a> <a href="#/" class="logo"> <img src="images/logo-white.c5cd00c3.png" alt="contratobook"> </a> </div>'),a.put("views/home.html",'<div ng-include="\'views/sidebar.html\'" layout="row" onload="packery.layout()"> </div> <div id="home-content" class="main-container" flex layout-fill> <packery draggable="false"> <div contentful-entries="\'content_type=2wKn6yEnZewu2SCCkus4as&amp;order=-sys.createdAt\'"> <packery-object class="item" ng-style="sizePack(entry)" ng-repeat="entry in $contentfulEntries.items"> <img ng-if="entry.fields.featuredImage" ng-src="{{getImageUrl(entry)}}" alt> <h3>{{entry.fields.title}}</h3> </packery-object> </div> </packery> </div>'),a.put("views/sidebar.html",'<md-sidenav class="md-sidenav-left md-whiteframe-z2 main-sidenav" md-component-id="filters" md-is-locked-open="$mdMedia(\'gt-md\')" md-whiteframe="4"> <md-content> <h2 class="logobox"> <a href="#/"> <img src="images/contratologo.0735f142.png" alt="contratobook"> <!--<span>contrato<strong>Book</strong></span>--> </a> </h2> <a href="#/contratos" class="menu-item menu-title" ng-class="ctbookRoutes.basePath() === &quot;contratos&quot; ? &quot;selected&quot; : &quot;&quot;" md-ink-ripple="#bbb" ng-click="contratosActionMenu()"> <i class="fa fa-folder-open"></i> Contratos <span class="menu-item-toggle" ng-show="toggleFilters && ctbookRoutes.basePath() === &quot;contratos&quot; " ng-click="toggleFilters = !toggleFilters" href=""> Ocultar filtros <i class="fa fa-arrow-circle-up"></i> </span> <span class="menu-item-toggle" ng-show="!toggleFilters && ctbookRoutes.basePath() === &quot;contratos&quot; " ng-click="toggleFilters = !toggleFilters" href=""> Mostrar filtros <i class="fa fa-arrow-circle-down"></i> </span> </a> <section class="sidenav-filter padding" ng-show="ctbookRoutes.basePath() === &quot;contratos&quot; && toggleFilters"> <md-content flex class="md-padding"> <section class="autocomplete-search-area" layout="column"> <!-- <md-input-container flex>\n            <label>Busqueda por texto</label>\n            <input ng-model="vm.params.textFilter" ng-keypress=\'vm.textSearch($event)\' >\n          </md-input-container>\n --> <md-autocomplete md-search-text-change="" md-selected-item-change="vm.addItem(item,\'dependencias\');dependencia=\'\'" md-selected-item="vm.selectedItem" md-search-text="dependencia" md-items="item in ctbookApi.autocomplete(dependencia,\'dependencia\',\'Dependencia\')" md-item-text="item.dependencia" md-min-length="1" md-floating-label="Dependencia"> <md-item-template> <span md-highlight-text="dependencia" md-highlight-flags="^i">{{item.dependencia}}</span> </md-item-template> <md-not-found> No se encontraron resultados. </md-not-found> </md-autocomplete> <md-autocomplete md-search-text-change="" md-selected-item-change="vm.addItem(item,\'ucs\');nombre_de_la_uc=\'\'" md-selected-item="vm.selectedItem2" md-search-text="nombre_de_la_uc" md-items="item in ctbookApi.autocomplete(nombre_de_la_uc,\'nombre_de_la_uc\',\'UnidadCompradora\')" md-item-text="item.nombre_de_la_uc" md-min-length="1" md-floating-label="Unidad compradora" placeholder=""> <md-item-template> <span md-highlight-text="nombre_de_la_uc" md-highlight-flags="^i">{{item.nombre_de_la_uc}}</span> </md-item-template> <md-not-found> No se encontraron resultados. </md-not-found> </md-autocomplete> <md-autocomplete md-search-text-change="" md-selected-item-change="vm.addItem(item,\'empresas\');proveedor_contratista=\'\'" md-selected-item="vm.selectedItem3" md-search-text="proveedor_contratista" md-items="item in ctbookApi.autocomplete(proveedor_contratista,\'proveedor_contratista\',\'Empresa\')" md-item-text="item.proveedor_contratista" md-min-length="1" md-floating-label="Empresa"> <md-item-template> <span md-highlight-text="proveedor_contratista" md-highlight-flags="^i">{{item.proveedor_contratista}}</span> </md-item-template> <md-not-found> No se encontraron resultados. </md-not-found> </md-autocomplete> </section> <h5 class="subtitle">Filtrar por aÃ±o</h5> <div layout-align="center center"> <div class="year-range" layout="row" layout-align="space-between center"> <span>Desde</span> <span>{{vm.params.year.start}}</span> </div> <md-slider flex="80" ng-model="vm.params.year.start" min="2002" max="{{vm.params.year.end}}" ng-mouseup="vm.sliderup($event)" aria-label="aÃ±o" md-discrete></md-slider> <div class="year-range" layout="row" layout-align="space-between center"> <span>Hasta</span> <span>{{vm.params.year.end}}</span> </div> <md-slider flex="80" ng-model="vm.params.year.end" min="{{vm.params.year.start}}" ng-mouseup="vm.sliderup($event)" max="2015" aria-label="aÃ±o" md-discrete></md-slider> </div> </md-content> </section> <!--     <a href=\'#/dependencias\' class=\'menu-item menu-title\' ng-class=\'ctbookRoutes.path == "/dependencias" ? "selected" : ""\' md-ink-ripple="#bbb" ng-click=\'ctbookRoutes.path = "/dependencias"\' >\n      <i class="fa fa-institution"></i>\n      Dependencias\n    </a> --> <section ng-show="ctbookRoutes.path == &quot;/dependencias&quot;" class="sidenav-filter"> <md-content flex class="md-padding"> <md-input-container label="provedor" class="ng-isolate-scope md-default-theme ng-valid md-input-has-value" aria-invalid="false"> <label for="dependenciaInput" class="ng-binding">Dependencia</label> <input id="dependenciaInput" type="text" ng-model="dependencia" typeahead-min-length="3" typeahead-wait-ms="500" typeahead="dependencia.dependencia for dependencia in getAutocomplete($viewValue,&quot;dependencia&quot;,&quot;dependencia&quot;)" typeahead-on-select="addItem($item,&quot;dependencia&quot;);dependencia=&quot;&quot;"> </md-input-container> </md-content> </section> <a href="#/empresas" class="menu-item menu-title" ng-class="ctbookRoutes.path == &quot;/empresas&quot; ? &quot;selected&quot; : &quot;&quot;" md-ink-ripple="#bbb" ng-click="ctbookRoutes.path = &quot;/empresas&quot;"> <i class="fa fa-suitcase"></i> Empresas </a> <md-content ng-show="ctbookRoutes.path == &quot;/empresas&quot;" flex class="md-padding"> <md-input-container label="empresa" class="ng-isolate-scope md-default-theme ng-valid md-input-has-value" aria-invalid="false"> <label for="empresaInput" class="ng-binding">Empresa</label> <input id="empresaInput" type="text" ng-model="empresa" ng-change="vm.textQuery(empresa)" ng-model-options="{debounce: 1000}"> </md-input-container> </md-content> <!-- <md-content class="user-list-wrapper" ng-if=\'ctbookRoutes.basePath() == "contrato"\' flex ng-include="\'views/twitter-feed.html\'"></md-content> --> </md-content> </md-sidenav>'),a.put("views/twitter-feed.html",'<md-list class="user-list"> <div layout="row" layout-align="center center"> <section class="send-comment"> <p><i class="fa fa-commenting"></i></p> <p><strong>USA ESTE HASHTAG</strong></p> <p><strong>#{{vm.contract.hashTag}}</strong></p> <a target="_blank" ng-href="https://twitter.com/intent/tweet?text=%23{{vm.contract.hashTag}}" class="send-comment-btn">Escribe un comentario</a> </section> </div> <md-list-item class="md-3-line" ng-repeat="tweet in tweets"> <img ng-src="{{tweet.user.profile_image_url_https}}" class="md-avatar" alt="{{item.who}}"> <div class="md-list-item-text"> <h3><strong>@{{ tweet.user.screen_name }}</strong></h3> <h4>{{ tweet.text }}</h4> <p>{{ tweet.created_at }}</p> </div> </md-list-item> </md-list>')}]);